# REMEBER: this is desyned from previously made checking system. sync it

# in repo
repos:
  - repo: local
    hooks:
      - id: precommit_guard
        name: git guard (no main commits + stale ref)
        entry: python tools/precommit_guard.py
        language: system
        pass_filenames: false

      - id: pyright
        name: pyright (type check)
        entry: pyright
        language: system
        pass_filenames: false

      - id: pytest-fast
        name: pytest (fast suite)
        entry: python -m pytest -m "not slow and not integration"
        language: system
        pass_filenames: false

      - id: blocks-artifacts
        name: Artifact blocker (forbidden artifacts)
        entry: python tools/blocks_artifacts.py --mode=staged
        language: system
        pass_filenames: false


  # ruff
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.10
    hooks:
      - id: ruff-format
      - id: ruff-check

      # Docstring lint gate: ONLY public surface + core modules.
      # Public surface rule: src/diffusion_core/__init__.py and src/diffusion_core/api/**
      # Core modules: enforce module/function/class docstrings when these exist.
      - id: ruff-check
        name: ruff (docstring gate)
        args: ["--select", "D"]
        files: >
          ^src/diffusion_core/(
            __init__\.py|
            api/|
            config/|
            run_layout\.py|
            executor\.py|
            logging\.py|
            eval/|
            metrics/|
            checkpointing\.py|
            determinism\.py
          )


